<!DOCTYPE html>

<html lang="nl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0" />
  <title>Suus Dashboard ğŸ¾</title>
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg'><text y='32' font-size='32'>ğŸ¶</text></svg>" />
  <link href="https://fonts.googleapis.com/css2?family=Fredoka+One&family=Nunito:wght@400;600;700;800&display=swap" rel="stylesheet" />
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body { font-family: 'Nunito', sans-serif; background: linear-gradient(135deg, #FFF0F5, #FDF4FF 50%, #F0F9FF); min-height: 100vh; }
    @keyframes bounce { 0%,100%{transform:translateY(0)} 50%{transform:translateY(-5px)} }
    @keyframes pulse  { 0%,100%{opacity:1} 50%{opacity:.7} }
    @keyframes fadeIn { from{opacity:0;transform:translateY(10px)} to{opacity:1;transform:translateY(0)} }
    @keyframes wiggle { 0%,100%{transform:rotate(-3deg)} 50%{transform:rotate(3deg)} }

```
.header { background: white; box-shadow: 0 2px 16px rgba(0,0,0,.07); position: sticky; top: 0; z-index: 100; }
.header-inner { max-width: 540px; margin: 0 auto; padding: 10px 14px; }
.header-top { display: flex; align-items: center; justify-content: space-between; margin-bottom: 8px; }
.logo { display: flex; align-items: center; gap: 10px; }
.logo-dog { font-size: 30px; display: inline-block; animation: wiggle 2s infinite; }
.logo-title { font-family: 'Fredoka One', cursive; font-size: 22px; color: #7C3AED; line-height: 1; }
.logo-sub { font-size: 10px; color: #10B981; font-weight: 700; letter-spacing: 1px; }
.header-status { text-align: right; }
.status-home { font-family: 'Fredoka One', cursive; font-size: 14px; }
.status-walk { font-size: 11px; color: #9CA3AF; }
.nav { display: flex; gap: 4px; overflow-x: auto; padding-bottom: 2px; }
.nav button { background: none; border: none; cursor: pointer; font-family: 'Fredoka One', cursive; font-size: 14px; padding: 9px 15px; border-radius: 50px; transition: all .18s; white-space: nowrap; font-weight: 600; color: #6B7280; }
.nav button.active { font-weight: 800; }

.content { max-width: 540px; margin: 0 auto; padding: 16px 14px 80px; }

.card { background: white; border-radius: 22px; padding: 18px; box-shadow: 0 4px 20px rgba(0,0,0,.07); margin-bottom: 14px; animation: fadeIn .3s ease both; }
.card-title { font-family: 'Fredoka One', cursive; font-size: 19px; color: #374151; margin-bottom: 3px; }
.card-sub { font-size: 12px; color: #9CA3AF; margin-bottom: 14px; font-weight: 600; }

.btn { border: none; border-radius: 50px; cursor: pointer; font-family: 'Fredoka One', cursive; padding: 10px 20px; transition: all .18s; font-size: 15px; }
.btn:hover { transform: scale(1.04); }
.btn:active { transform: scale(.97); }

.person-card { border-radius: 18px; padding: 13px 16px; display: flex; align-items: center; gap: 11px; cursor: pointer; transition: all .18s; border: 3px solid #E5E7EB; margin-bottom: 9px; background: #F9FAFB; }
.person-card:hover { transform: scale(1.015); }
.person-card.home { background: var(--pc-bg); border-color: var(--pc-color); }
.person-name { font-family: 'Fredoka One', cursive; font-size: 16px; color: #374151; }
.person-card.home .person-name { color: var(--pc-color); }
.person-status { font-size: 12px; color: #9CA3AF; }
.person-card.home .person-status { color: var(--pc-color); font-weight: 700; }
.person-icon { width: 34px; height: 34px; border-radius: 50%; background: #E5E7EB; display: flex; align-items: center; justify-content: center; font-size: 16px; flex-shrink: 0; }
.person-card.home .person-icon { animation: bounce 0.6s ease; }

.alone-warning { padding: 14px 18px; border-radius: 18px; margin-bottom: 14px; display: flex; gap: 12px; align-items: center; }
.alone-warning.danger { background: #FEE2E2; border: 3px solid #EF4444; animation: pulse 1.5s infinite; }
.alone-warning.warn   { background: #FEF3C7; border: 3px solid #F59E0B; }
.alone-warning.ok     { background: #F0FDF4; border: 3px solid #22C55E; }
.alone-title { font-family: 'Fredoka One', cursive; font-size: 16px; color: #374151; }
.alone-sub   { font-size: 12px; font-weight: 700; margin-top: 2px; }

.team-box { margin-top: 8px; padding: 12px 16px; background: linear-gradient(135deg,#EFF6FF,#F0FDF4); border-radius: 14px; border: 2px solid #93C5FD; }
.team-title { font-family: 'Fredoka One', cursive; font-size: 14px; color: #1D4ED8; margin-bottom: 8px; }
.team-pills { display: flex; flex-wrap: wrap; gap: 7px; }
.pill { display: inline-flex; align-items: center; gap: 5px; border-radius: 50px; padding: 6px 14px; font-family: 'Fredoka One', cursive; font-size: 14px; color: white; }

label { font-size: 12px; font-weight: 700; color: #374151; margin-bottom: 4px; display: block; }
select, input[type=text], input[type=date], input[type=time], textarea {
  border: 2px solid #E5E7EB; border-radius: 12px; padding: 9px 13px;
  font-family: 'Nunito', sans-serif; font-size: 14px; outline: none; width: 100%;
}
select:focus, input:focus, textarea:focus { border-color: #A855F7; }
textarea { resize: vertical; }
.grid2 { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; margin-bottom: 10px; }
.span2 { grid-column: 1 / -1; }

.plan-item { display: flex; align-items: center; gap: 10px; padding: 10px 14px; border-radius: 14px; margin-bottom: 8px; border: 2px solid #E5E7EB; }
.plan-item.past { background: #F9FAFB; opacity: 0.6; }
.plan-name { font-family: 'Fredoka One', cursive; font-size: 15px; }
.plan-info { font-size: 12px; color: #6B7280; }
.tag-past { font-size: 11px; font-weight: 700; background: #E5E7EB; color: #9CA3AF; border-radius: 50px; padding: 3px 10px; white-space: nowrap; }
.del-btn { background: none; border: none; cursor: pointer; font-size: 18px; color: #9CA3AF; padding: 0 4px; }

.walk-btn-row { display: flex; gap: 6px; flex-wrap: wrap; }

.diary-photo { width: 100%; border-radius: 14px; margin-bottom: 10px; max-height: 240px; object-fit: cover; }
.diary-meta { display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px; }
.diary-author { font-family: 'Fredoka One', cursive; font-size: 15px; color: #7C3AED; }
.diary-date { font-size: 11px; color: #9CA3AF; font-weight: 700; }
.diary-story { font-size: 14px; color: #374151; line-height: 1.65; }

.photo-preview-wrap { position: relative; }
.photo-remove { position: absolute; top: 8px; right: 8px; background: white; border: none; border-radius: 50%; width: 26px; height: 26px; cursor: pointer; font-size: 13px; }

.empty-state { text-align: center; padding: 40px; color: #9CA3AF; }
.empty-icon { font-size: 48px; margin-bottom: 10px; }
.empty-title { font-family: 'Fredoka One', cursive; font-size: 18px; }
.empty-sub { font-size: 13px; margin-top: 6px; }
```

  </style>
</head>
<body>

<div class="header">
  <div class="header-inner">
    <div class="header-top">
      <div class="logo">
        <span class="logo-dog">ğŸ¶</span>
        <div>
          <div class="logo-title">Suus</div>
          <div class="logo-sub">â— LIVE Â· elke 5 sec</div>
        </div>
      </div>
      <div class="header-status">
        <div class="status-home" id="statusHome">â³ laden...</div>
        <div class="status-walk" id="statusWalk"></div>
      </div>
    </div>
    <div class="nav">
      <button class="active" style="background:#FDF4FF;color:#7C3AED" onclick="showPage('home',this)">ğŸ  Thuis</button>
      <button onclick="showPage('planner',this)">ğŸ“… Planner</button>
      <button onclick="showPage('diary',this)">ğŸ“” Dagboek</button>
    </div>
  </div>
</div>

<div class="content">

  <!-- HOME -->

  <div id="page-home">
    <div id="aloneWarning" style="display:none"></div>

```
<div class="card">
  <div style="display:flex;align-items:center;justify-content:space-between;flex-wrap:wrap;gap:10px">
    <div>
      <div style="font-family:'Fredoka One',cursive;font-size:16px;color:#374151">ğŸ¦® Laatste uitlaatbeurt</div>
      <div id="lastWalkInfo" style="font-size:13px;color:#9CA3AF;margin-top:3px">Nog niet geregistreerd</div>
    </div>
    <div class="walk-btn-row" id="walkBtns"></div>
  </div>
</div>

<div class="card">
  <div class="card-title">Wie is er thuis?</div>
  <div class="card-sub">Tik op je naam om in/uit te checken Â· iedereen ziet dit live ğŸ”´</div>
  <div id="personList"></div>
  <div id="teamBox" style="display:none" class="team-box">
    <div class="team-title">ğŸ¾ Suus is in goede handen bij:</div>
    <div class="team-pills" id="teamPills"></div>
  </div>
</div>
```

  </div>

  <!-- PLANNER -->

  <div id="page-planner" style="display:none">
    <div class="card" style="border:2px solid #93C5FD">
      <div style="font-family:'Fredoka One',cursive;font-size:19px;color:#1D4ED8;margin-bottom:14px">ğŸ¦® Uitlaatbeurt inplannen</div>
      <div class="grid2">
        <div><label>Wie laat uit?</label><select id="wpWho"></select></div>
        <div><label>Datum</label><input type="date" id="wpDate" /></div>
        <div><label>Tijd</label><input type="time" id="wpTime" /></div>
        <div><label>Notitie (optioneel)</label><input type="text" id="wpNote" placeholder="Bijv. lang wandelen" /></div>
      </div>
      <button class="btn" onclick="addWalk()" style="background:linear-gradient(135deg,#3B82F6,#6366F1);color:white;width:100%;font-size:16px;padding:12px">â• Inplannen</button>
    </div>
    <div id="walkList"></div>

```
<div class="card" style="border:2px solid #FCD34D">
  <div style="font-family:'Fredoka One',cursive;font-size:19px;color:#D97706;margin-bottom:14px">ğŸ¥ Afspraak toevoegen</div>
  <div class="grid2">
    <div class="span2"><label>Titel</label><input type="text" id="apTitle" placeholder="Bijv. Dierenarts controle" /></div>
    <div><label>Datum</label><input type="date" id="apDate" /></div>
    <div><label>Tijd (optioneel)</label><input type="time" id="apTime" /></div>
    <div class="span2"><label>Notitie (optioneel)</label><input type="text" id="apNote" placeholder="Extra info..." /></div>
  </div>
  <button class="btn" onclick="addAppt()" style="background:linear-gradient(135deg,#F59E0B,#EF4444);color:white;width:100%;font-size:16px;padding:12px">â• Afspraak toevoegen</button>
</div>
<div id="apptList"></div>
```

  </div>

  <!-- DIARY -->

  <div id="page-diary" style="display:none">
    <div class="card" style="border:2px solid #F9A8D4">
      <div style="font-family:'Fredoka One',cursive;font-size:19px;color:#DB2777;margin-bottom:14px">ğŸ“ Nieuw verhaaltje</div>
      <div style="margin-bottom:10px"><label>Jouw naam</label><input type="text" id="dAuthor" placeholder="Wie schrijft dit?" /></div>
      <div style="margin-bottom:10px"><label>Verhaaltje over Suus ğŸ¾</label><textarea id="dStory" rows="4" placeholder="Wat deed Suus vandaag?"></textarea></div>
      <div style="margin-bottom:14px">
        <label>Foto toevoegen</label>
        <input type="file" id="dPhotoInput" accept="image/*" style="display:none" onchange="handlePhoto(this)" />
        <div id="photoPreview" style="display:none" class="photo-preview-wrap">
          <img id="photoImg" class="diary-photo" style="margin-bottom:0" />
          <button class="photo-remove" onclick="removePhoto()">âœ•</button>
        </div>
        <button id="photoBtn" class="btn" onclick="document.getElementById('dPhotoInput').click()" style="background:#FDF4FF;color:#7C3AED;width:100%;border:2px dashed #C084FC">ğŸ“· Foto kiezen</button>
      </div>
      <button class="btn" onclick="addDiary()" style="background:linear-gradient(135deg,#FF6B9D,#A855F7);color:white;width:100%;font-size:17px;padding:13px;box-shadow:0 4px 15px rgba(168,85,247,.35)">ğŸ¾ Post toevoegen!</button>
    </div>
    <div id="diaryList"></div>
  </div>

</div>

<script>
const DB = "https://suus-dashboard-default-rtdb.europe-west1.firebasedatabase.app";
const FAMILY = [
  { name:"Simone", emoji:"ğŸ‘©", color:"#FF6B9D" },
  { name:"Iris",   emoji:"ğŸŒ¸", color:"#A855F7" },
  { name:"Joris",  emoji:"ğŸ§”", color:"#3B82F6" },
  { name:"CornÃ©",  emoji:"ğŸ©", color:"#F59E0B" },
  { name:"Miranda",emoji:"ğŸŒ»", color:"#10B981" },
];
const MAX_ALONE_MS = 4 * 60 * 60 * 1000;

let state = { checkedIn:{}, aloneFrom:null, lastWalk:null, walkPlan:{}, appts:{}, diary:{} };
let photoData = null;

// Firebase REST
async function fbGet(path) {
  try { const r = await fetch(`${DB}/${path}.json`); return await r.json(); } catch { return null; }
}
async function fbSet(path, data) {
  try { await fetch(`${DB}/${path}.json`, { method:"PUT", headers:{"Content-Type":"application/json"}, body:JSON.stringify(data) }); } catch {}
}
async function fbPush(path, data) {
  try { const r = await fetch(`${DB}/${path}.json`, { method:"POST", headers:{"Content-Type":"application/json"}, body:JSON.stringify(data) }); return await r.json(); } catch {}
}
async function fbDelete(path) {
  try { await fetch(`${DB}/${path}.json`, { method:"DELETE" }); } catch {}
}

// Helpers
function elapsed(ts) {
  if (!ts) return "";
  const m = Math.floor((Date.now()-ts)/60000), h = Math.floor(m/60);
  return h>0 ? `${h}u ${m%60}m` : `${m} min`;
}
function fmtTime(ts) {
  if (!ts) return "";
  return new Date(ts).toLocaleTimeString("nl-NL",{hour:"2-digit",minute:"2-digit"});
}
function fmtDateShort(str) {
  return new Date(str+"T12:00:00").toLocaleDateString("nl-NL",{day:"numeric",month:"short"});
}
function fmtDateLong(ts) {
  return new Date(ts).toLocaleDateString("nl-NL",{day:"numeric",month:"long",year:"numeric"});
}
function fmtDateFull(str) {
  return new Date(str+"T12:00:00").toLocaleDateString("nl-NL",{day:"numeric",month:"long",year:"numeric"});
}
function todayStr() { return new Date().toISOString().split("T")[0]; }

// Navigation
function showPage(name, btn) {
  ["home","planner","diary"].forEach(p => {
    document.getElementById("page-"+p).style.display = p===name?"block":"none";
  });
  document.querySelectorAll(".nav button").forEach(b => {
    b.classList.remove("active");
    b.style.background="none";
    b.style.color="#6B7280";
    b.style.fontWeight="600";
  });
  const colors = {home:"#7C3AED",planner:"#D97706",diary:"#DB2777"};
  const bgs = {home:"#FDF4FF",planner:"#FFF7ED",diary:"#FFF0F5"};
  btn.classList.add("active");
  btn.style.background=bgs[name];
  btn.style.color=colors[name];
  btn.style.fontWeight="800";
}

// Render
function render() {
  const names = Object.keys(state.checkedIn||{});

  // Header status
  const sh = document.getElementById("statusHome");
  sh.textContent = names.length>0 ? `ğŸ  ${names.length} thuis` : "ğŸ˜¢ Niemand thuis";
  sh.style.color = names.length>0 ? "#16A34A" : "#EF4444";
  const sw = document.getElementById("statusWalk");
  sw.textContent = state.lastWalk ? `ğŸ¦® ${fmtTime(state.lastWalk.ts)} door ${state.lastWalk.by}` : "";

  // Alone warning
  const aw = document.getElementById("aloneWarning");
  if (!state.aloneFrom || names.length>0) {
    aw.style.display="none";
  } else {
    const ms = Date.now()-state.aloneFrom;
    const danger=ms>=MAX_ALONE_MS, warn=ms>=MAX_ALONE_MS*0.75;
    aw.style.display="block";
    aw.className="alone-warning "+(danger?"danger":warn?"warn":"ok");
    aw.innerHTML=`<span style="font-size:30px">${danger?"ğŸš¨":warn?"â°":"âœ…"}</span><div>
      <div class="alone-title">Suus is al <strong style="color:${danger?"#EF4444":warn?"#D97706":"#16A34A"}">${elapsed(state.aloneFrom)}</strong> alleen</div>
      ${danger?'<div class="alone-sub" style="color:#EF4444">Suus heeft nu echt gezelschap nodig! ğŸ¾</div>':""}
    </div>`;
  }

  // Last walk
  const lwi = document.getElementById("lastWalkInfo");
  lwi.textContent = state.lastWalk
    ? `door ${state.lastWalk.by} Â· ${fmtDateLong(state.lastWalk.ts)} ${fmtTime(state.lastWalk.ts)}`
    : "Nog niet geregistreerd";
  lwi.style.color = state.lastWalk ? "#6B7280" : "#9CA3AF";

  // Walk buttons
  const wb = document.getElementById("walkBtns");
  if (names.length>0) {
    wb.innerHTML = names.map(n=>`<button class="btn" onclick="registerWalk('${n}')" style="background:#DCFCE7;color:#16A34A;font-size:13px;padding:8px 14px">âœ… ${n}</button>`).join("");
  } else {
    wb.innerHTML=`<button class="btn" onclick="registerWalk('Onbekend')" style="background:#DCFCE7;color:#16A34A;font-size:13px">âœ… Uitgelaten!</button>`;
  }

  // Person list
  const pl = document.getElementById("personList");
  pl.innerHTML = FAMILY.map(p => {
    const ts = state.checkedIn && state.checkedIn[p.name];
    const isHome = !!ts;
    return `<div class="person-card${isHome?" home":""}" style="--pc-color:${p.color};--pc-bg:${p.color}12" onclick="togglePerson('${p.name}')">
      <span style="font-size:26px">${p.emoji}</span>
      <div style="flex:1">
        <div class="person-name">${p.name}</div>
        <div class="person-status">${isHome?`âœ“ Thuis sinds ${fmtTime(ts)} Â· ${elapsed(ts)} geleden`:"Niet thuis"}</div>
      </div>
      <div class="person-icon" style="${isHome?`background:${p.color}`:""}">
        ${isHome?"ğŸ ":"ğŸšª"}
      </div>
    </div>`;
  }).join("");

  // Team box
  const tb = document.getElementById("teamBox");
  if (names.length>0) {
    tb.style.display="block";
    document.getElementById("teamPills").innerHTML = names.map(n=>{
      const p=FAMILY.find(f=>f.name===n);
      return `<span class="pill" style="background:${p?.color}">${p?.emoji} ${n}</span>`;
    }).join("");
  } else { tb.style.display="none"; }

  // Walk plan list
  const wl = document.getElementById("walkList");
  const walkArr = state.walkPlan && typeof state.walkPlan==="object"
    ? Object.entries(state.walkPlan).map(([id,v])=>({...v,id})).sort((a,b)=>(a.date+a.time).localeCompare(b.date+b.time)) : [];
  if (walkArr.length>0) {
    wl.innerHTML=`<div class="card"><div style="font-family:'Fredoka One',cursive;font-size:16px;color:#374151;margin-bottom:10px">ğŸ“‹ Geplande uitlaatbeurten</div>`+
    walkArr.map(w=>{
      const p=FAMILY.find(f=>f.name===w.who);
      const isPast=w.date<todayStr()||(w.date===todayStr()&&w.time<new Date().toTimeString().slice(0,5));
      return `<div class="plan-item${isPast?" past":""}" style="${isPast?"":`background:${p?.color}10;border-color:${p?.color}`}">
        <span style="font-size:22px">${p?.emoji}</span>
        <div style="flex:1">
          <div class="plan-name" style="color:${p?.color}">${w.who}</div>
          <div class="plan-info">ğŸ“… ${fmtDateShort(w.date)} Â· â° ${w.time}${w.note?` Â· ${w.note}`:""}</div>
        </div>
        ${isPast?'<span class="tag-past">Verlopen</span>':""}
        <button class="del-btn" onclick="deleteWalk('${w.id}')">âœ•</button>
      </div>`;
    }).join("")+"</div>";
  } else { wl.innerHTML=""; }

  // Appt list
  const al2 = document.getElementById("apptList");
  const apptArr = state.appts && typeof state.appts==="object"
    ? Object.entries(state.appts).map(([id,v])=>({...v,id})).sort((a,b)=>(a.date+a.time).localeCompare(b.date+b.time)) : [];
  if (apptArr.length>0) {
    al2.innerHTML=`<div class="card"><div style="font-family:'Fredoka One',cursive;font-size:16px;color:#374151;margin-bottom:10px">ğŸ“‹ Afspraken</div>`+
    apptArr.map(a=>{
      const isPast=a.date<todayStr();
      return `<div class="plan-item${isPast?" past":""}" style="${isPast?"":`background:#FFFBEB;border-color:#FCD34D`}">
        <span style="font-size:22px">ğŸ¥</span>
        <div style="flex:1">
          <div class="plan-name" style="color:#D97706">${a.title}</div>
          <div class="plan-info">ğŸ“… ${fmtDateFull(a.date)}${a.time?` Â· â° ${a.time}`:""}${a.note?` Â· ${a.note}`:""}</div>
        </div>
        ${isPast?'<span class="tag-past">Verlopen</span>':""}
        <button class="del-btn" onclick="deleteAppt('${a.id}')">âœ•</button>
      </div>`;
    }).join("")+"</div>";
  } else { al2.innerHTML=""; }

  // Diary
  const dl = document.getElementById("diaryList");
  const diaryArr = state.diary && typeof state.diary==="object"
    ? Object.entries(state.diary).map(([id,v])=>({...v,id})).sort((a,b)=>b.ts-a.ts) : [];
  const bgs=["#FFF0F5","#FDF4FF","#F0F9FF","#FFF7ED","#F0FDF4"];
  const borders=["#F9A8D4","#C084FC","#93C5FD","#FCD34D","#6EE7B7"];
  if (diaryArr.length===0) {
    dl.innerHTML=`<div class="empty-state"><div class="empty-icon">ğŸ“”</div><div class="empty-title">Het dagboek is nog leeg!</div><div class="empty-sub">Schrijf het eerste verhaaltje over Suus ğŸ¶</div></div>`;
  } else {
    dl.innerHTML=diaryArr.map((e,i)=>`
      <div class="card" style="background:${bgs[i%5]};border:2px solid ${borders[i%5]}">
        ${e.photo?`<img src="${e.photo}" class="diary-photo" />`:""}
        <div class="diary-meta">
          <span class="diary-author">ğŸ¾ ${e.author}</span>
          <span class="diary-date">${e.date} Â· ${e.time}</span>
        </div>
        <p class="diary-story">${e.story}</p>
      </div>`).join("");
  }
}

// Actions
async function togglePerson(name) {
  const ci = state.checkedIn||{};
  const isIn = !!ci[name];
  const newIn = {...ci};
  if (isIn) delete newIn[name]; else newIn[name]=Date.now();
  state.checkedIn=newIn;
  state.aloneFrom=Object.keys(newIn).length===0?Date.now():null;
  render();
  await fbSet("checkedIn", newIn);
  await fbSet("aloneFrom", state.aloneFrom);
}

async function registerWalk(by) {
  state.lastWalk={by,ts:Date.now()};
  render();
  await fbSet("lastWalk", state.lastWalk);
}

async function addWalk() {
  const who=document.getElementById("wpWho").value;
  const date=document.getElementById("wpDate").value;
  const time=document.getElementById("wpTime").value;
  const note=document.getElementById("wpNote").value;
  if (!date||!time) return alert("Vul datum en tijd in!");
  await fbPush("walkPlan",{who,date,time,note,ts:Date.now()});
  document.getElementById("wpDate").value="";
  document.getElementById("wpTime").value="";
  document.getElementById("wpNote").value="";
  await fetchAll();
}

async function deleteWalk(id) {
  await fbDelete(`walkPlan/${id}`);
  await fetchAll();
}

async function addAppt() {
  const title=document.getElementById("apTitle").value;
  const date=document.getElementById("apDate").value;
  const time=document.getElementById("apTime").value;
  const note=document.getElementById("apNote").value;
  if (!title||!date) return alert("Vul titel en datum in!");
  await fbPush("appts",{title,date,time,note,ts:Date.now()});
  document.getElementById("apTitle").value="";
  document.getElementById("apDate").value="";
  document.getElementById("apTime").value="";
  document.getElementById("apNote").value="";
  await fetchAll();
}

async function deleteAppt(id) {
  await fbDelete(`appts/${id}`);
  await fetchAll();
}

function handlePhoto(input) {
  const file=input.files[0]; if (!file) return;
  const reader=new FileReader();
  reader.onload=ev=>{
    photoData=ev.target.result;
    document.getElementById("photoImg").src=photoData;
    document.getElementById("photoPreview").style.display="block";
    document.getElementById("photoBtn").style.display="none";
  };
  reader.readAsDataURL(file);
}

function removePhoto() {
  photoData=null;
  document.getElementById("photoPreview").style.display="none";
  document.getElementById("photoBtn").style.display="block";
  document.getElementById("dPhotoInput").value="";
}

async function addDiary() {
  const author=document.getElementById("dAuthor").value;
  const story=document.getElementById("dStory").value;
  if (!story.trim()) return alert("Schrijf eerst een verhaaltje!");
  await fbPush("diary",{
    author:author.trim()||"Anoniem", story:story.trim(), photo:photoData||null,
    date:fmtDateLong(Date.now()),
    time:new Date().toLocaleTimeString("nl-NL",{hour:"2-digit",minute:"2-digit"}),
    ts:Date.now()
  });
  document.getElementById("dAuthor").value="";
  document.getElementById("dStory").value="";
  removePhoto();
  await fetchAll();
}

// Data fetching
async function fetchAll() {
  const [checkedIn,aloneFrom,lastWalk,walkPlan,appts,diary] = await Promise.all([
    fbGet("checkedIn"), fbGet("aloneFrom"), fbGet("lastWalk"),
    fbGet("walkPlan"), fbGet("appts"), fbGet("diary")
  ]);
  state = {
    checkedIn: checkedIn||{}, aloneFrom, lastWalk,
    walkPlan: walkPlan||{}, appts: appts||{}, diary: diary||{}
  };
  render();
}

// Init
document.getElementById("wpDate").min = todayStr();
document.getElementById("apDate").min = todayStr();
const wpWhoSel = document.getElementById("wpWho");
FAMILY.forEach(f=>{ const o=document.createElement("option"); o.textContent=f.name; wpWhoSel.appendChild(o); });

fetchAll();
setInterval(fetchAll, 5000);

// Update elapsed times every minute
setInterval(render, 60000);
</script>

</body>
</html>
